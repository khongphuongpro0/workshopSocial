<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=/workshopSocial/images/favicon.png type=image/png><title>ECR, Docker, Security Group, ALB, ECS Service và Kết thúc :: Báo cáo thực tập</title>
<link href=/workshopSocial/css/nucleus.css?1765297595 rel=stylesheet><link href=/workshopSocial/css/fontawesome-all.min.css?1765297595 rel=stylesheet><link href=/workshopSocial/css/hybrid.css?1765297595 rel=stylesheet><link href=/workshopSocial/css/featherlight.min.css?1765297595 rel=stylesheet><link href=/workshopSocial/css/perfect-scrollbar.min.css?1765297595 rel=stylesheet><link href=/workshopSocial/css/auto-complete.css?1765297595 rel=stylesheet><link href=/workshopSocial/css/atom-one-dark-reasonable.css?1765297595 rel=stylesheet><link href=/workshopSocial/css/theme.css?1765297595 rel=stylesheet><link href=/workshopSocial/css/hugo-theme.css?1765297595 rel=stylesheet><link href=/workshopSocial/css/theme-workshop.css?1765297595 rel=stylesheet><script src=/workshopSocial/js/jquery-3.3.1.min.js?1765297595></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/workshopSocial/vi/5-workshop/5.6-cleanup/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=/><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/workshopSocial/js/lunr.min.js?1765297595></script><script type=text/javascript src=/workshopSocial/js/auto-complete.js?1765297595></script><script type=text/javascript>var baseurl="https://khongphuongpro0.github.io/workshopSocial//vi"</script><script type=text/javascript src=/workshopSocial/js/search.js?1765297595></script></div><div class=highlightable><ul class=topics><li data-nav-id=/workshopSocial/vi/1-worklog/ title="Nhật ký công việc" class=dd-item><a href=/workshopSocial/vi/1-worklog/><b>1. </b>Nhật ký công việc
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/workshopSocial/vi/1-worklog/1.1-week1/ title="Worklog Tuần 1" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.1-week1/><b>1.1. </b>Worklog Tuần 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.2-week2/ title="Worklog Tuần 2" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.2-week2/><b>1.2. </b>Worklog Tuần 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.3-week3/ title="Worklog Tuần 3" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.3-week3/><b>1.3. </b>Worklog Tuần 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.4-week4/ title="Worklog Tuần 4" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.4-week4/><b>1.4. </b>Worklog Tuần 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.5-week5/ title="Worklog Tuần 5" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.5-week5/><b>1.5. </b>Worklog Tuần 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.6-week6/ title="Worklog Tuần 6" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.6-week6/><b>1.6. </b>Worklog Tuần 6
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.7-week7/ title="Worklog Tuần 7" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.7-week7/><b>1.7. </b>Worklog Tuần 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.8-week8/ title="Worklog Tuần 8" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.8-week8/><b>1.8. </b>Worklog Tuần 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.9-week9/ title="Worklog Tuần 9" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.9-week9/><b>1.9. </b>Worklog Tuần 9
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.10-week10/ title="Worklog Tuần 10" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.10-week10/><b>1.10. </b>Worklog Tuần 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.11-week11/ title="Worklog Tuần 11" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.11-week11/><b>1.11. </b>Worklog Tuần 11
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/1-worklog/1.12-week12/ title="Worklog Tuần 12" class=dd-item><a href=/workshopSocial/vi/1-worklog/1.12-week12/><b>1.12 </b>Worklog Tuần 12
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/workshopSocial/vi/2-proposal/ title="Bản đề xuất" class=dd-item><a href=/workshopSocial/vi/2-proposal/><b>2. </b>Bản đề xuất
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/3-blogstranslated/ title="Các bài blogs đã dịch" class=dd-item><a href=/workshopSocial/vi/3-blogstranslated/><b>3. </b>Các bài blogs đã dịch
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/workshopSocial/vi/3-blogstranslated/3.1-blog1/ title="Blog 1.Mở rộng SAP Field Service Management với AWS: Cách tiếp cận Clean Core cho việc lưu trữ tệp đính kèm" class=dd-item><a href=/workshopSocial/vi/3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1.Mở rộng SAP Field Service Management với AWS: Cách tiếp cận Clean Core cho việc lưu trữ tệp đính kèm
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/3-blogstranslated/3.3-blog3/ title="Blog 3. Xây dựng ứng dụng SAP nhanh chóng với Amazon Q Developer" class=dd-item><a href=/workshopSocial/vi/3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3. Xây dựng ứng dụng SAP nhanh chóng với Amazon Q Developer
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/3-blogstranslated/3.2-blog2/ title="Blog 2.Xây dựng kết nối mạng Hybrid đạt tiêu chuẩn cho doanh nghiệp trên AWS cho SAP Cloud ERP Private" class=dd-item><a href=/workshopSocial/vi/3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2.Xây dựng kết nối mạng Hybrid đạt tiêu chuẩn cho doanh nghiệp trên AWS cho SAP Cloud ERP Private
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/workshopSocial/vi/4-eventparticipated/ title="Các events đã tham gia" class=dd-item><a href=/workshopSocial/vi/4-eventparticipated/><b>4. </b>Các events đã tham gia
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/workshopSocial/vi/4-eventparticipated/4.1-event1/ title="Event 1: Kick-off OJT Cloud Journey" class=dd-item><a href=/workshopSocial/vi/4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1: Kick-off OJT Cloud Journey
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/4-eventparticipated/4.2-event2/ title="Event 2: AWS Perimeter Protection Workshop" class=dd-item><a href=/workshopSocial/vi/4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2: AWS Perimeter Protection Workshop
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/workshopSocial/vi/5-workshop/ title="Workshop: Triển khai Ứng dụng Web Social Media trên AWS" class="dd-item
parent"><a href=/workshopSocial/vi/5-workshop/><b>5.</b> Workshop: Triển khai Ứng dụng Web Social Media trên AWS
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/workshopSocial/vi/5-workshop/5.3-s3-vpc/ title="Cấu hình Route 53 và Mạng VPC" class=dd-item><a href=/workshopSocial/vi/5-workshop/5.3-s3-vpc/><b>5.3</b> Cấu hình Route 53 và Mạng VPC
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/5-workshop/5.4-s3-onprem/ title="Tạo Nat Gateway và Cấu hình Route Table" class=dd-item><a href=/workshopSocial/vi/5-workshop/5.4-s3-onprem/><b>5.4.</b> Tạo Nat Gateway và Cấu hình Route Table
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/5-workshop/5.5-policy/ title="Thiết lập Subnet Group và Database RDS" class=dd-item><a href=/workshopSocial/vi/5-workshop/5.5-policy/><b>5.5.</b> Thiết lập Subnet Group và Database RDS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/5-workshop/5.6-cleanup/ title="ECR, Docker, Security Group, ALB, ECS Service và Kết thúc" class="dd-item
active"><a href=/workshopSocial/vi/5-workshop/5.6-cleanup/><b>5.6.</b> ECR, Docker, Security Group, ALB, ECS Service và Kết thúc
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/workshopSocial/vi/6-self-evaluation/ title="Tự đánh giá" class=dd-item><a href=/workshopSocial/vi/6-self-evaluation/><b>6. </b>Tự đánh giá
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshopSocial/vi/7-feedback/ title="Chia sẻ, đóng góp ý kiến" class=dd-item><a href=/workshopSocial/vi/7-feedback/><b>7. </b>Chia sẻ, đóng góp ý kiến
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://khongphuongpro0.github.io/workshopSocial/5-workshop/5.6-cleanup/>English</option><option id=vi value=https://khongphuongpro0.github.io/workshopSocial/vi/5-workshop/5.6-cleanup/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/workshopSocial/vi/>Báo cáo thực tập</a> > <a href=/workshopSocial/vi/5-workshop/>Workshop: Triển khai Ứng dụng Web Social Media trên AWS</a> > ECR, Docker, Security Group, ALB, ECS Service và Kết thúc</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#61-docker-ecr-và-push-image>6.1. Docker, ECR và Push Image</a><ul><li><a href=#611-tạo-ecr-elastic-container-registry>6.1.1. Tạo ECR (Elastic Container Registry)</a></li><li><a href=#612-dockerfile-và-build-image>6.1.2. Dockerfile và Build Image</a></li><li><a href=#613-đăng-nhập-và-push-image-lên-ecr>6.1.3. Đăng nhập và Push Image lên ECR</a></li></ul></li><li><a href=#62-tạo-security-group>6.2. Tạo Security Group</a><ul><li><a href=#621-security-group-cho-alb-internet-facing>6.2.1. Security Group cho ALB (Internet-Facing)</a></li><li><a href=#622-security-group-cho-ecs-backend>6.2.2. Security Group cho ECS (Backend)</a></li><li><a href=#623-security-group-cho-rds-database>6.2.3. Security Group cho RDS (Database)</a></li></ul></li><li><a href=#63-tạo-target-group-và-alb>6.3. Tạo Target Group và ALB</a><ul><li><a href=#631-tạo-target-group>6.3.1. Tạo Target Group</a></li><li><a href=#632-tạo-application-load-balancer-alb>6.3.2. Tạo Application Load Balancer (ALB)</a></li></ul></li><li><a href=#64-tạo-ecs-cluster-và-service>6.4. Tạo ECS Cluster và Service</a><ul><li><a href=#641-tạo-ecs-cluster>6.4.1. Tạo ECS Cluster</a></li><li><a href=#642-cấu-hình-task-definition>6.4.2. Cấu hình Task Definition</a></li><li><a href=#643-tạo-ecs-service>6.4.3. Tạo ECS Service</a></li><li><a href=#644-cấu-hình-record-route-53-trỏ-về-alb>6.4.4. Cấu hình Record Route 53 trỏ về ALB</a></li></ul></li><li><a href=#65-kết-quả>6.5. Kết quả</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>ECR, Docker, Security Group, ALB, ECS Service và Kết thúc</h1><p>Đây là các bước cuối cùng để đóng gói ứng dụng Backend, tạo các thành phần bảo mật/Load Balancer và triển khai lên <strong>ECS Fargate</strong>.</p><h2 id=61-docker-ecr-và-push-image>6.1. Docker, ECR và Push Image</h2><h3 id=611-tạo-ecr-elastic-container-registry>6.1.1. Tạo ECR (Elastic Container Registry)</h3><ol><li>Vào dịch vụ <strong>ECR</strong> và tạo Repository (ví dụ: <code>social-media-backend</code>).</li></ol><p><img alt="Ta vào comman line nhập các configure sau đó tạo" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECR_1.png></p><ol start=2><li>Đã có ECR.</li></ol><p><img alt="Đã có ecr" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECR_2.png></p><h3 id=612-dockerfile-và-build-image>6.1.2. Dockerfile và Build Image</h3><ol><li>Tạo <strong>Dockerfile</strong> ngang hàng với folder backend (sử dụng cấu trúc Onion).</li></ol><p><img alt="Tiếp đến là build file lên docker, vì là cấu trúc onion nên ta sẽ đặt Dockerfile ở ngang với folder backend, với src chính là folder backend" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECR_3.png></p><ol start=2><li>Cấu hình file Docker.</li></ol><p><img alt="Tiếp đến ta cấu hình file docker" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECR_4.png></p><ol start=3><li>Chạy lệnh <code>docker build -t social-media-backend .</code> để build. Đóng gói thành công.</li></ol><p><img alt="Và chạy lệnh docker build -t social-media-backend . để build. Đóng gói thành công" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECR_5.png></p><h3 id=613-đăng-nhập-và-push-image-lên-ecr>6.1.3. Đăng nhập và Push Image lên ECR</h3><ol><li>Đăng nhập vào ECR bằng command line, verify tag, kiểm tra lại bằng <code>docker image</code>.</li></ol><p><img alt="Đăng nhập vào ECR bằng comman line, verify tag, kiểm tra lại bằng docker image" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECR_6.png></p><ol start=2><li>Chạy lệnh để push image lên ECR. Hoàn thành việc push.</li></ol><p><img alt="Sau đó chạy lệnh để push image lên ecr. Hoàn thành việc push" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECR_7.png></p><h2 id=62-tạo-security-group>6.2. Tạo Security Group</h2><p>Ta tạo 3 Security Group: 1 cho ALB, 1 cho ECS/Backend, 1 cho RDS/Database.</p><h3 id=621-security-group-cho-alb-internet-facing>6.2.1. Security Group cho ALB (Internet-Facing)</h3><ol><li>Chọn <strong>Create security group</strong>. Đặt tên, chọn VPC đã tạo.</li><li>Ở phần <strong>Inbound rules</strong>, chọn <strong>HTTP</strong> và <strong>HTTPS</strong> với <strong>Source</strong> là <strong>mọi nơi</strong> (<code>0.0.0.0/0</code> và <code>::/0</code>), ấn <strong>Create</strong>.</li></ol><p><img alt="Đặt tên, chọn vpc đã tạo và ở phần inbound rules chọn http và https với source là mọi nơi, ấn tạo" src=./images/SecurityGroup_2.png></p><h3 id=622-security-group-cho-ecs-backend>6.2.2. Security Group cho ECS (Backend)</h3><ol><li>Đặt tên, chọn VPC. <strong>Lưu ý:</strong> Port của Dockerfile là <strong>8080</strong>, nên <strong>Inbound rule</strong> sẽ là <strong>Custom TCP</strong> Port <strong>8080</strong>.</li><li><strong>Source</strong> sẽ là <strong>Security Group</strong> của <strong>ALB</strong> vừa tạo (chỉ ALB được phép gửi traffic đến ECS).</li></ol><p><img alt="Tiếp đến ta tạo security group cho ecs, có vài điều cần lưu ý là port của dockerfile, trong dockerfile tôi để port là 8080 nên sẽ để ở đây là 8080, source sẽ phải lấy của security group ALB ta vừa mới tạo" src=/workshopSocial/5-workshop/5.6-cleanup/images/SecurityGroup_3.png></p><h3 id=623-security-group-cho-rds-database>6.2.3. Security Group cho RDS (Database)</h3><ol><li>Đặt tên, chọn VPC. <strong>Lưu ý:</strong> <strong>Inbound rule</strong> sẽ là <strong>Port MySQL</strong> (3306).</li><li><strong>Source</strong> sẽ là <strong>Security Group</strong> của <strong>ECS</strong> vừa tạo (chỉ ECS được phép truy cập RDS).</li></ol><p><img alt="Tiếp tục đến security group cho ecs, ở ecs thì ta chọn port mysql và source là của security group ecs ta vừa mới tạo" src=/workshopSocial/5-workshop/5.6-cleanup/images/SecurityGroup_4.png></p><ol start=3><li>Tổng quan ta đã có 3 Security Group.</li></ol><p><img alt="Tổng quan ta đã có 3 security group" src=/workshopSocial/5-workshop/5.6-cleanup/images/SecurityGroup_5.png>
<img alt="Tổng quan ta đã có 3 security group" src=/workshopSocial/5-workshop/5.6-cleanup/images/SecurityGroup_6.png></p><h2 id=63-tạo-target-group-và-alb>6.3. Tạo Target Group và ALB</h2><h3 id=631-tạo-target-group>6.3.1. Tạo Target Group</h3><ol><li>Vào <strong>EC2</strong> -> <strong>Target Group</strong>, chọn <strong>Create target group</strong>.</li></ol><p><img alt="Vào EC2 -> Target Group chọn create target group" src=/workshopSocial/5-workshop/5.6-cleanup/images/TargetGroup_1.png></p><ol start=2><li>Chọn <strong>Type</strong> là <strong>IP address</strong>.</li></ol><p><img alt="Ta chọn type là IP address" src=/workshopSocial/5-workshop/5.6-cleanup/images/TargetGroup_2.png></p><ol start=3><li>Đặt tên, <strong>Port</strong> là <strong>8080</strong> (trong Dockerfile), chọn VPC đã tạo.</li></ol><p><img alt="Đặt tên group name, port là 8080 đã cấu hình trong docker file và chọn vpc đã tạo" src=/workshopSocial/5-workshop/5.6-cleanup/images/TargetGroup_3.png></p><ol start=4><li>Ở mục <strong>Healthy threshold</strong> chọn <strong>2</strong>, còn lại để mặc định và ấn <strong>Create</strong>.</li></ol><p><img alt="Ở mục healthy threshold ta chọn 2, còn lại để mặc định" src=/workshopSocial/5-workshop/5.6-cleanup/images/TargetGroup_4.png></p><ol start=5><li>Hoàn thành việc tạo Target Group.</li></ol><p><img alt="Nhấn next ở trang tiếp theo và chọn create, hiển thị tạo thành công" src=/workshopSocial/5-workshop/5.6-cleanup/images/TargetGroup_5.png></p><h3 id=632-tạo-application-load-balancer-alb>6.3.2. Tạo Application Load Balancer (ALB)</h3><ol><li>Vào <strong>EC2</strong> -> <strong>Load Balancers</strong>, nhấn <strong>Create Load Balancer</strong>. Chọn loại <strong>Application Load Balancer</strong>.</li></ol><p><img alt="Cũng trong EC2 ta qua tạo Load Balancers, ta nhấn tạo. Ta chọn loại Application Load Balancer" src=/workshopSocial/5-workshop/5.6-cleanup/images/ALB_2.png></p><ol start=2><li>Đặt tên, chọn <strong>Scheme</strong> là <strong>internet-facing</strong>, <strong>IP address type</strong> là <strong>Ipv4</strong>.</li></ol><p><img alt="Đặt tên, chọn scheme là internet-facing, chọn loại ip address type là Ipv4" src=/workshopSocial/5-workshop/5.6-cleanup/images/ALB_3.png></p><ol start=3><li>Ở <strong>Network mapping</strong>, chọn 2 AZ và 2 <strong>Public Subnet</strong> tương ứng.</li></ol><p><img alt="Ở NetWork mapping, ta chọn 2 az và chọn 2 public subnet tương ứng" src=/workshopSocial/5-workshop/5.6-cleanup/images/ALB_4.png></p><ol start=4><li>Ở <strong>Security group</strong>, chọn Security Group đã tạo cho ALB.</li></ol><p><img alt="Ở security group thì ta chọn security ta tạo cho alb" src=/workshopSocial/5-workshop/5.6-cleanup/images/ALB_5.png></p><ol start=5><li>Ở <strong>Listeners</strong>, ta tạo 2 Listener:<ul><li><strong>Listener 1 (HTTP 80)</strong>: Cấu hình trỏ đến HTTPS.</li></ul></li></ol><p><img alt="Listener 1 ta cấu hình nó như trong hình cho loại http" src=/workshopSocial/5-workshop/5.6-cleanup/images/ALB_6.png></p><pre><code>* **Listener 2 (HTTPS 443)**: Ở **Routing action**, chọn **Forward to target group**, chọn Target Group vừa mới tạo.
</code></pre><p><img alt="Listener 2, ở routing action ta chọn forward to target group, chọn target group vừa mới tạo" src=/workshopSocial/5-workshop/5.6-cleanup/images/ALB_7.png></p><ol start=6><li>Ở phần cấu hình an toàn cho Listener (HTTPS), chọn <strong>Certification</strong> đã tạo ở phần Route 53 (ACM).</li></ol><p><img alt="Ở phần cấu hình an toàn cho listener ta chọn Certification đã tạo ở phần route 53" src=/workshopSocial/5-workshop/5.6-cleanup/images/ALB_8.png></p><ol start=7><li>Nhấn <strong>Create</strong>. Màn hình hiển thị tạo thành công.</li></ol><p><img alt="Sau đó nhấn tạo, màn hình hiển thị tạo thành công" src=/workshopSocial/5-workshop/5.6-cleanup/images/ALB_9.png></p><h2 id=64-tạo-ecs-cluster-và-service>6.4. Tạo ECS Cluster và Service</h2><h3 id=641-tạo-ecs-cluster>6.4.1. Tạo ECS Cluster</h3><ol><li>Vào dịch vụ <strong>ECS</strong>, tab <strong>Clusters</strong>, nhấn <strong>Create Cluster</strong>.</li></ol><p><img alt="Vào dịch vụ ECS, tab Cluster, nhấn tạo cluster" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECScluster_1.png></p><ol start=2><li>Đặt tên và chọn kiến trúc là <strong>Fargate only</strong>.</li></ol><p><img alt="Ta đặt tên và chọn kiến trúc, ở đây kiến trúc sẽ sử dụng là Farget only" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECScluster_2.png></p><ol start=3><li>Nhấn <strong>Create</strong>. Tạo thành công.</li></ol><p><img alt=ECScluster_3.png src=/workshopSocial/5-workshop/5.6-cleanup/images/ECScluster_3.png></p><h3 id=642-cấu-hình-task-definition>6.4.2. Cấu hình Task Definition</h3><ol><li>Vào tab <strong>Task definitions</strong>, nhấn <strong>Create new task definition</strong>.</li></ol><p><img alt="Cùng ở service ECS, ta vào tab Task definitions, nhấn tạo task" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECScluster_4.png></p><ol start=2><li>Chọn tạo bằng file <strong>JSON</strong> (góc trên phải màn hình).</li></ol><p><img alt="Ta sẽ chọn ở góc phía trên phải màn hình tạo bằng file json" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECScluster_5.png></p><ol start=3><li>Sử dụng cấu trúc file JSON chứa các thông tin như: image của ECR, port tương ứng, biến môi trường (kết nối database), và CORS (cho phép domain đã mua).</li></ol><p><img alt="Với cấu trúc file json như sau, lần lượt là image của ecr, port tương ứng, biến môi trường, biến kết nối database, và CORS cho phép địa chỉ domain đã mua, ấn tạo" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECScluster_6.png>
<img alt="Với cấu trúc file json như sau, lần lượt là image của ecr, port tương ứng, biến môi trường, biến kết nối database, và CORS cho phép địa chỉ domain đã mua, ấn tạo" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECScluster_7.png></p><ol start=4><li>Ấn <strong>Create</strong>. Tạo thành công.</li></ol><p><img alt="Tạo thành công" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECScluster_8.png></p><h3 id=643-tạo-ecs-service>6.4.3. Tạo ECS Service</h3><ol><li>Vào Cluster vừa tạo, kéo xuống tab <strong>Services</strong> chọn <strong>Create Service</strong>.</li></ol><p><img alt="Vào cluster chọn cluster mới tạo" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_1.png>
<img alt="Kéo xuống tab service chọn tạo service" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_2.png></p><ol start=2><li>Ở <strong>Service detail</strong>, chọn <strong>Task</strong> mới tạo, đặt tên <strong>Service name</strong>.</li></ol><p><img alt="Ở phần Service detail chọn task mới tạo, đặt tên service name" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_3.png></p><ol start=3><li>Ở <strong>Environment</strong>, chọn <strong>Launch type</strong> (Fargate).</li></ol><p><img alt="Ở environment chọn kiểu là Launch type và để mặc định các phần khác" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_4.png></p><ol start=4><li>Ở <strong>Deployment configuration</strong>, để mặc định.</li></ol><p><img alt="Ở mục deployment configuration ta để mặc định" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_5.png></p><ol start=5><li>Ở <strong>Networking</strong>, chọn VPC đã tạo, 2 <strong>Private Subnet</strong> tương ứng với ECS và tắt chức năng <strong>Public IP</strong>.</li></ol><p><img alt="Ở mục networking, ta chọn vpc ta tạo, 2 private subnet tương ứng với ecs và rds, tắt chức năng public IP" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_6.png></p><ol start=6><li>Ở phần <strong>Load balancing</strong>, tick vào <strong>Use load balancing</strong>.<ul><li>Sử dụng <strong>ALB</strong> đã tồn tại và dùng <strong>Listener</strong> đã tạo trước đó.</li></ul></li></ol><p><img alt="Ở phần Load balancing ta tick vào nút use load balancing. Sử dụng ALB đã tồn tại , và dùng listener đã tạo trước đó" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_7.png>
<img alt="Sử dụng ALB đã tồn tại , và dùng listener đã tạo trước đó" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_8.png></p><ol start=7><li>Chọn <strong>Target Group</strong> đã tồn tại và chọn Target Group đã làm ở bước trước đó.</li></ol><p><img alt="Cuối cùng chọn target group đã tồn tại và chọn target group ta đã làm ở bước trước đó" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_9.png></p><ol start=8><li>Cuối cùng nhấn <strong>Create</strong>. Task đã chạy thành công.</li></ol><p><img alt="Cuối cùng nhấn create, task đã chạy thành công" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_10.png></p><h3 id=644-cấu-hình-record-route-53-trỏ-về-alb>6.4.4. Cấu hình Record Route 53 trỏ về ALB</h3><ol><li>Tạo record Route 53, cấu hình trỏ đến <strong>ALB</strong> đã tạo. <strong>Name</strong> là <code>api</code> (ví dụ: <code>api.social-sgu-media.click</code>), và ấn <strong>Create</strong>.</li></ol><p><img alt="Sau đó ta tạo record route 53, cấu hình cho qua ALB đã tạo, name là api, và ấn tạo" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_11.png></p><ol start=2><li>Tạo thành công.</li></ol><p><img alt="Tạo thành công" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_12.png></p><h2 id=65-kết-quả>6.5. Kết quả</h2><p>Chạy thử với URL API đã cấu hình (ví dụ: <code>https://api.social-sgu-media.click/</code>).</p><p><img alt="Vậy ta đã hoàn thành xong, ta chạy thử với url là https://api.social-sgu-media.click/" src=/workshopSocial/5-workshop/5.6-cleanup/images/ECSService_13.png></p><p>Thành công! Vậy là ta đã hoàn thành xong Workshop triển khai ứng dụng Social Media trên AWS.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/workshopSocial/vi/5-workshop/5.5-policy/ title="Thiết lập Subnet Group và Database RDS"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/workshopSocial/vi/6-self-evaluation/ title="Tự đánh giá" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/workshopSocial/js/clipboard.min.js?1765297595></script><script src=/workshopSocial/js/perfect-scrollbar.min.js?1765297595></script><script src=/workshopSocial/js/perfect-scrollbar.jquery.min.js?1765297595></script><script src=/workshopSocial/js/jquery.sticky.js?1765297595></script><script src=/workshopSocial/js/featherlight.min.js?1765297595></script><script src=/workshopSocial/js/highlight.pack.js?1765297595></script><script>hljs.initHighlightingOnLoad()</script><script src=/workshopSocial/js/modernizr.custom-3.6.0.js?1765297595></script><script src=/workshopSocial/js/learn.js?1765297595></script><script src=/workshopSocial/js/hugo-learn.js?1765297595></script><link href=/workshopSocial/mermaid/mermaid.css?1765297595 rel=stylesheet><script src=/workshopSocial/mermaid/mermaid.js?1765297595></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>